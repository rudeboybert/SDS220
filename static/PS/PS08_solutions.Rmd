
---
title: "Problem Set 08"
author: "WRITE YOUR NAME HERE"
date: "2018-11-07"
output:
  html_document:
    highlight: tango
    theme: cosmo
    toc: yes
    toc_depth: 2
    toc_float:
      collapsed: false
    df_print: kable
---

```{r, include=FALSE}
# Do not edit this code block/chunk
knitr::opts_chunk$set(echo = TRUE, message=FALSE, warning = FALSE, fig.width = 16/2, fig.height = 9/2)
```

# Collaboration {-}

Please indicate who you collaborated with on this problem set: 



# Background {-}

We will again use the hate crimes data we used in Problem Set 02 & 07. The FiveThirtyEight article article about those data are in the Jan 23, 2017  ["Higher Rates Of Hate Crimes Are Tied To Income
Inequality"](https://fivethirtyeight.com/features/higher-rates-of-hate-crimes-are-tied-to-income-inequality/). This week, we will use these data  to run regression models with a single categorical predictor (explanatory) variable **and** a single numeric predictor (explanatory) variable. 

## Setup

First load the necessary packages 

```{r}
library(ggplot2)
library(dplyr)
library(moderndive)
library(fivethirtyeight)
```

Next let's explore the `hate_crimes` dataset in the `fivethirtyeight` package using the `glimpse()` function from the `dplyr` package:

```{r}
glimpse(hate_crimes)
```

You should also use the `View()` function to take a look at the data in the viewer, Recall we can't have `View()` in an R Markdown document! And finally, type `?hate_crimes` into the console to see a description of the variables in this data set. 

## Data manipulation

We will next add a new column to this data set that expresses the Share of the population that lives in metropolitan areas, 2015 categorical variable. Run this code below. 

```{r}
hate_crimes <- hate_crimes %>% 
  mutate(urbanization = cut_number(share_pop_metro, 2, labels = c("low", "high")))
```

Recall, the `cut_numbers` function sorts the `share_pop_metro` variable from lowest to highest, cuts it into two groups. It categorizes all the lowest values as `"low"`, and the largest values as `"high"`. Finally, let's express the share of adults 25 and older with a high-school degree in 2009 as a percentage. 

```{r}
hate_crimes <- hate_crimes %>% 
  mutate(prct_hs = share_pop_hs *100)
```



# Question 1: 

Let's model the relationship between:

* $y$: Median household income in 2016
* $x_1$: numerical variable percent of adults 25 and older with a high-school degree in 2009, contained in the `prct_hs` variable we mutated above. 
* $x_2$: categorical variable level of urbanization in a state: `low`,  or `high`, as
contained in the variable `urbanization` we mutated above.


## a) Visual model

First, visualize the parallel slopes model for this data that will allow you to conduct an "eyeball test" of the relationship between **all three variables** (see Lec22 for instructions on how to update the `moderndive` package to include the `gg_parallel_slopes` function that does this):

```{r}
gg_parallel_slopes(y = "median_house_inc", num_x = "prct_hs", cat_x = "urbanization",
                   data = hate_crimes) +
  labs(
    x = "Percent of adults with high-school degree", 
    y = "Median household income", 
    title = "Education and income in states with differing levels of urbanization"
  )
```



## b) Relationship between variables

Comment on the relationship between the variables.

**Answer:** It looks like there is a positive, fairly strong, linear relationship between education and income in states with low and high levels of urbanization. It also looks like, overall, there is higher median income in states that are more urbanized.


## c) Regression model

Now run a model that examines the relationship between median household income, high-school education, and urbanization. 

```{r}
med_income_model <- lm(median_house_inc ~ prct_hs + urbanization, data = hate_crimes)
get_regression_table(med_income_model)
```


## d) Quantifying the relationship

Let's now quantify the relationship between the outcome and explanatory variables. 

1. Is the intercept the same for the states with a "low" and "high" level of urbanization? (look at the data visualization above to help with this!) Is the slope the same? 
1. What is the slope for the regression line of the states with a "low" level of urbanization? What is the intercept?
1. What is the slope for the regression line of the states with a "high" level of urbanization? What is the intercept?
1. For every increase in 1% of high-school educated adults, what is the associated increase in the median household income of a state?
1. Based on your regression table output, is median household income greater in states that have lower or higher levels of urbanization?
1. Use the `get_regression_points` function to look at the predicted values for median income. We have a categorical value this week, just like last week. Why don't we only have two unique predicted values again this week?

**Answers:** 

1. Slope is the same, intercept is not. 
1. Slope is 1977, Intercept is -119929
1. Slope is 1977, Intercept is -119929 + 6980 = -112949
1. $1,977 
1. Median household income is greater in states with high levels of urbanization  
1. Because we are incorporating a second variable that is numeric, and for which the value differs across the observations. 


## e) Prediction

1. What would you predict as the median household income for a state with a **high** level of urbanization, in which 85% of the share of adults have a high school degree?
1. What would you predict as the median household income for a state with a **low** level of urbanization, in which 85% of the share of adults have a high school degree?
1. What would you predict as the median household income for a state with a **low** level of urbanization, in which 30% of the share of adults have a high school degree?
1. What is the prediction for Alaska? What is the residual? Did our model over or underestimate the median income for this state? 


**Answers:**

1. (-119929.869 + 6980.048) + (1977.508 * 85) = 55138.36
1. (-119929.869) + (1977.508 * 85) = 48158.31
1. I wouldn't make a prediction. The lowest percentage in our data set was ~ 70, so extrapolating like this would not be a good idea. 
1. (-119929.869) + (1977.508 * 91.4) = 60814.36. Since the observed value for household income for Alaska was 67629, the residual is 6815, and thus the model under-estimated. Where did I get the above values from?

```{r}
hate_crimes %>%
  filter(state == "Alaska") %>% 
  select(urbanization, prct_hs)

# urbanization high
-119929.869 + (1977.508* 85) + (6980.048 * 1)

# urbanization low
-119929.869 + (1977.508* 85) + (6980.048 * 0)

# urbanization low in Alaska 
-119929.869 + (1977.508*91.4) 
```


## Extra credit: 

Imagine that federal budget cuts caused a reduction across all states of ~ 2% in
high school graduation rates. We can make a new data set that reflects these
budget cuts like so:

```{r}
budget_cuts <- hate_crimes %>%
  mutate(prct_hs = prct_hs - 2) %>% 
  select(state, urbanization, prct_hs)
```

Generate a table that shows the predicted median household income for **each
state**, based on our previous model. (For the sake of the exercise, assume that
it is OK to make predictions just slightly outside of the range of percent HS
education values used in our original model)

```{r}
get_regression_points(med_income_model, newdata = budget_cuts) 
```

